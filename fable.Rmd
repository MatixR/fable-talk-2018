---
title: "Tidy Forecasting\\newline in R"
author: "Rob J Hyndman"
date: "ISF 2018"
fontsize: 14pt
output:
  beamer_presentation:
    fig_height: 4.33
    fig_width: 6
    highlight: tango
    incremental: no
    theme: metropolis
    includes:
      in_header: preamble.tex
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo=TRUE,
  message=FALSE,
  warning=FALSE,
  cache=FALSE,
  dev.args=list(bg=grey(0.9), pointsize=11)
)
savepdf <- function(file, width=16, height=16*4.33/6)
{
  fname <<- paste("figs/",file,".pdf",sep="")
  pdf(fname, width=width/2.54, height=height/2.54, pointsize=10)
  par(mgp=c(2.2,0.45,0), tcl=-0.4, mar=c(3.3,3.6,1.1,1.1))
}
endpdf <- function()
{
  dev.off()
#  crop::dev.off.crop(fname)
}
set.seed(28052018)
options(digits=3)
```

# forecast package
\fontsize{13}{14.5}\sf

\hspace*{-0.6cm}\begin{tabular}{rl}
Pre 2003         & Private functions used for consulting projects \\
July/August 2003 & \textbf{ets} and \textbf{thetaf} added\\
%2003--2006      & Package available at robjhyndman.com \\
August 2006      & \textcolor{orange}{v1.0} available on CRAN \\
May 2007         & \textbf{auto.arima} added\\
%July 2008       & JSS paper (Hyndman \& Khandakar)\\
%September 2009  & \textcolor{orange}{v2.0}. Unbundled \\
May 2010         & \textbf{arfima} added\\
Feb/March 2011   & \textbf{tslm}, \textbf{stlf}, \textbf{naive}, \textbf{snaive} added \\
August 2011      & \textcolor{orange}{v3.0}. Box Cox transformations added\\
December 2011    & \textbf{tbats} added\\
April 2012       & Package moved to github\\
November 2012    & \textcolor{orange}{v4.0}. \textbf{nnetar} added\\
June 2013        & Major speed-up of \textbf{ets}\\
%December 2015   & 264,000 package downloads in one month!\\
February 2016    & \textcolor{orange}{v7.0}. Added ggplot2 graphics\\
February 2017    & \textcolor{orange}{v8.0}. Added \textbf{checkresiduals}, \textbf{tsCV} and \textbf{\%>\%}\\
April 2018       & \textcolor{orange}{v8.3}. Added \textbf{mstl}\\
June 2018        & $\approx$ 100,000 package downloads per month
\end{tabular}

# fable package

\begin{alertblock}{}
A replacement for the forecast package.
\end{alertblock}

## Why change?
\fontsize{14}{15.5}\sf

 * Interacting with tidyverse packages
 * Sub-daily data and multiple seasonal data handled more easily
 * Consistency of interface
 * Distribution forecasting rather than point+interval
 * Simpler interface for hierarchical and grouped forecast reconciliation
 * Designed for multivariate forecasting
 * Changes will break too much existing code
 * Opportunity to re-think forecasting practice

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe, echo=TRUE}
library(fpp2)
auscafe
```

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe2, echo=TRUE}
library(tsibble)
cafe <- as_tsibble(auscafe)
cafe
```

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe3, echo=TRUE}
#library(fable)
library(tidyforecast)
cafe %>% ETS(value)
```

\vspace*{10cm}

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe4a, echo=TRUE}
cafe %>% ETS(value) %>% summary()
```

\vspace*{10cm}

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe4, echo=TRUE}
cafe %>% ETS(value) %>% forecast()
```

\vspace*{10cm}

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe5, echo=TRUE}
cafe %>% ETS(value) %>% forecast() %>% summary()
```

\vspace*{10cm}

# Example: Australian eating-out expenditure
\fontsize{11}{11}\sf

```{r auscafe6, echo=TRUE}
cafe %>% ARIMA(log(value)) %>% 
  forecast() %>% summary()
```

# Example: prison data
\fontsize{11}{11}\sf

```{r prison}
prisonLF
```


# Example: prison data
\fontsize{11}{11}\sf

```{r prison2}
prisonLF %>% 
  mutate(qtr=yearquarter(t)) %>%
  select(-t) %>%
  as_tsibble(index=qtr, key=id(state,gender,legal))
```


# Reconcilation?


# Equivalent methods

  * `auto.arima` $\longrightarrow$ `ARIMA`
  * `ets` $\longrightarrow$ `ETS`
  * `tbats`  $\longrightarrow$ `TBATS` 
  * `stlm` $\longrightarrow$ `STL???`

All modelling functions produce `mable` class objects.

# Equivalent methods

  * `stlf` $\longrightarrow$ `STL %>% forecast`
  * `thetaf` $\longrightarrow$ ??
  * `dshw`, `hw`, `holt`, `ses` ??
  * `splinef` $\longrightarrow$ ??
  * `rwf`, `naive` $\longrightarrow$ `RW %>% forecast`
  * `croston` $\longrightarrow$

`forecast` produces `fable` class objects.

# Download
\fontsize{12.8}{15}\sf


```r
devtools::install_github("tidyverts/tsibble")
devtools::install_github("tidyverts/fable")
```

# NUMBATS


\centerline{\includegraphics[width=13cm]{Numbat}}\vspace*{-0.7cm}

\begin{block}{}
\fontsize{11}{11}\sf
\centering\begin{tabular}{p{3.35cm}p{3.cm}p{3.5cm}}
\includegraphics[height=3.25cm]{dicook} &
\includegraphics[height=3cm]{earowang} &
\includegraphics[height=3cm]{mitch}\\
Di Cook & Earo Wang  & Mitchell O'Hara-Wild
\end{tabular}
\end{block}

\vspace*{10cm}

# More information
\LARGE

robjhyndman.com

OTexts.org/fpp2

tidyverts.org

